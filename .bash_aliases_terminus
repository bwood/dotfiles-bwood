##############
## Terminus ##
##############

_terminus-hostname() {
  SITE=$1
  if [ x$SITE = x ]; then
    echo "terminus-hostname Must pass a site shortname as the first argument, for example: site-name"
    exit 1
  fi

  ENV=$2
  if [ x$ENV = x ]; then
    echo "terminus-hostname: Must pass an environment as the second argument."
    exit 1
  fi

  TYPE=$3
  if [ x$TYPE = x ]; then
    echo "terminus-hostname: Must pass server type as the third argument."
    exit 1
  fi

  ID=$(terminus site info --field=id --site=$SITE)
  HOSTNAME=""
  if [ -n "$ID" ]; then 
    HOSTNAME="$ENV.$ID@$TYPE.$ENV.$ID.drush.in"
  else 
    echo ""
    echo "Site '$SITE' not found."
  fi
}

terminus-sftp() {
  SITE=$1
  if [ x$SITE = x ]; then
    echo "Must pass a site shortname as the first argument, for example: site-name"
    return
  fi

  _terminus-hostname "$SITE" "dev" "appserver"

  if [ -n "$HOSTNAME" ]; then
    CMD="sftp -o Port=2222 $HOSTNAME"
    echo $CMD
    $CMD    
  fi
}

alias tsftp=terminus-sftp

terminus-git-clone() {
  SITE=$1
  if [ x$SITE = x ]; then
    echo "Must pass a site shortname as the first argument, for example: site-name"
    return
  fi

  SITES_DIR=~/Sites/pantheon  
  cd $SITES_DIR
  if [ -d "$SITE" ]; then
    echo "You already cloned $SITE. Doing a git pull..." 
    cd $SITE
    git pull
    return
  fi

  TYPE="codeserver"
  _terminus-hostname $SITE "dev" $TYPE

  if [ -n "$HOSTNAME" ]; then
    CMD="git clone ssh://$TYPE.$HOSTNAME:2222/~/repository.git $SITE --depth=1"
    $CMD
    cd $SITE
  fi
}

alias tgc=terminus-git-clone


terminus-dashboard() {
  SITE=$1
  if [ x$SITE = x ]; then
    echo "Must pass a site shortname as the first argument, for example: site-name"
    return
  fi
  terminus site dashboard --yes --site=$SITE 
}

alias tdash=terminus-dashboard

terminus-site-wake() {
  SITE=$1
  if [ x$SITE = x ]; then
    echo "Must pass a site shortname as the first argument, for example: site-name"
    return
  fi
  terminus site wake --site=$SITE --env=dev
  terminus site wake --site=$SITE --env=test
}

alias tsite-wake=terminus-site-wake
alias tsw=terminus-site-wake

alias tal="terminus auth login $EMAIL_WORK"
#source /Users/bwood/bin/terminus-completion.bash

terminus-cache-clear () {
  terminus cli cache-clear
  terminus auth login $EMAIL_WORK
  terminus site info --site=openberkeley-ob # rebuild caches
}

alias tcc=terminus-cache-clear
